{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _readOnlyError from \"@babel/runtime/helpers/esm/readOnlyError\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Mr.X\\\\Desktop\\\\nextjs-sequelize\\\\pages\\\\user\\\\register.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport { useRouter } from 'next/router';\n/* utils */\n\n/* components */\nimport Layout from '../../components/layout/Layout';\nimport FormRegister from '../../components/form/FormRegister';\nvar emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n/* register schemas */\n\nvar FORM_DATA_REGISTER = {\n  username: {\n    value: '',\n    label: 'Username',\n    min: 5,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Username fill correctly'\n    }\n  },\n  email: {\n    value: '',\n    label: 'Email',\n    min: 10,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: emailRegEx,\n      error: 'Email fill correctly'\n    }\n  },\n  password: {\n    value: '',\n    label: 'Password',\n    min: 5,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Password fill correctly'\n    }\n  }\n};\n\nfunction Register(props) {\n  _s();\n\n  var router = useRouter();\n  var origin = props.origin,\n      baseApiUrl = props.baseApiUrl;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(FORM_DATA_REGISTER),\n      stateFormData = _useState2[0],\n      setStateFormData = _useState2[1];\n\n  var _useState3 = useState([]),\n      stateFormError = _useState3[0],\n      setStateFormError = _useState3[1];\n\n  var _useState4 = useState(false),\n      stateFormValid = _useState4[0],\n      setStateFormValid = _useState4[1];\n\n  var _useState5 = useState({}),\n      stateFormMessage = _useState5[0],\n      setStateFormMessage = _useState5[1];\n\n  function onChangeHandler(e) {\n    var _e$currentTarget = e.currentTarget,\n        name = _e$currentTarget.name,\n        value = _e$currentTarget.value;\n    setStateFormData(_objectSpread(_objectSpread({}, stateFormData), {}, _defineProperty({}, name, _objectSpread(_objectSpread({}, stateFormData[name]), {}, {\n      value: value\n    }))));\n    /* validation handler */\n\n    validationHandler(stateFormData, e);\n  }\n\n  function onSubmitHandler(_x) {\n    return _onSubmitHandler.apply(this, arguments);\n  }\n\n  function _onSubmitHandler() {\n    _onSubmitHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var data, isValid, _isValid, isUser;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              data = _objectSpread({}, stateFormData);\n              isValid = validationHandler(stateFormData);\n\n              if (!isValid) {\n                _context2.next = 14;\n                break;\n              }\n\n              data = _objectSpread(_objectSpread({}, data), {}, {\n                username: data.username.value\n              });\n              data = _objectSpread(_objectSpread({}, data), {}, {\n                email: data.email.value\n              });\n              data = _objectSpread(_objectSpread({}, data), {}, {\n                password: data.password.value\n              });\n              _isValid = validationHandler(stateFormData);\n\n              if (!_isValid) {\n                _context2.next = 14;\n                break;\n              }\n\n              setLoading(!loading);\n              _context2.next = 12;\n              return fetch(\"\".concat(baseApiUrl, \"/user\"), {\n                method: 'GET'\n              }).then(function (response) {\n                return response.json();\n              }).then(function (res) {\n                var x = res.data.filter(function (user) {\n                  return user.email === data.email;\n                });\n\n                if (x.length >= 1) {\n                  _isValid = (_readOnlyError(\"isValid\"), false);\n                  console.log('already exists');\n                } else {\n                  var _x2 = /*#__PURE__*/function () {\n                    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n                      var loginApi, result;\n                      return _regeneratorRuntime.wrap(function _callee$(_context) {\n                        while (1) {\n                          switch (_context.prev = _context.next) {\n                            case 0:\n                              _context.next = 2;\n                              return fetch(\"\".concat(baseApiUrl, \"/user\"), {\n                                method: 'POST',\n                                headers: {\n                                  Accept: 'application/json',\n                                  'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify(data)\n                              })[\"catch\"](function (error) {\n                                console.error('Error:', error);\n                              });\n\n                            case 2:\n                              loginApi = _context.sent;\n                              _context.next = 5;\n                              return loginApi.json();\n\n                            case 5:\n                              result = _context.sent;\n\n                              if (result.status === 'success' && result.message === 'done') {\n                                window.location.href = '/';\n                              } else {\n                                setStateFormMessage(result);\n                              }\n\n                            case 7:\n                            case \"end\":\n                              return _context.stop();\n                          }\n                        }\n                      }, _callee);\n                    }));\n\n                    return function _x2() {\n                      return _ref.apply(this, arguments);\n                    };\n                  }();\n\n                  _x2();\n                }\n              }).then(function () {\n                _isValid = (_readOnlyError(\"isValid\"), true);\n                console.log(_isValid);\n              });\n\n            case 12:\n              isUser = _context2.sent;\n              setLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _onSubmitHandler.apply(this, arguments);\n  }\n\n  function validationHandler(states, e) {\n    var input = e && e.target.name || '';\n    var errors = [];\n    var isValid = true;\n\n    if (input) {\n      if (states[input].required) {\n        if (!states[input].value) {\n          errors[input] = {\n            hint: \"\".concat(states[e.target.name].label, \" required\"),\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n\n      if (states[input].value && states[input].min > states[input].value.length) {\n        errors[input] = {\n          hint: \"Min \".concat(states[input].label, \" length \").concat(states[input].min),\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].value && states[input].max < states[input].value.length) {\n        errors[input] = {\n          hint: \"Min \".concat(states[input].label, \" length \").concat(states[input].max),\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].validator !== null && typeof states[input].validator === 'object') {\n        if (states[input].value && !states[input].validator.regEx.test(states[input].value)) {\n          errors[input] = {\n            hint: states[input].validator.error,\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n    } else {\n      Object.entries(states).forEach(function (item) {\n        item.forEach(function (field) {\n          errors[item[0]] = '';\n\n          if (field.required) {\n            if (!field.value) {\n              errors[item[0]] = {\n                hint: \"\".concat(field.label, \" required\"),\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n\n          if (field.value && field.min >= field.value.length) {\n            errors[item[0]] = {\n              hint: \"Min \".concat(field.label, \" length \").concat(field.min),\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.value && field.max <= field.value.length) {\n            errors[item[0]] = {\n              hint: \"Min \".concat(field.label, \" length \").concat(field.max),\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.validator !== null && typeof field.validator === 'object') {\n            if (field.value && !field.validator.regEx.test(field.value)) {\n              errors[item[0]] = {\n                hint: field.validator.error,\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n        });\n      });\n    }\n\n    if (isValid) {\n      setStateFormValid(isValid);\n    }\n\n    setStateFormError(_objectSpread({}, errors));\n    return isValid;\n  }\n\n  return __jsx(Layout, {\n    title: \"Next.js with Sequelize | Register page\",\n    url: \"\".concat(origin).concat(router.asPath),\n    origin: origin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 7\n    }\n  }, __jsx(\"main\", {\n    className: \"content-detail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: '/user'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }, __jsx(\"a\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }\n  }, \"\\u2190 Back\")), __jsx(FormRegister, {\n    props: {\n      onSubmitHandler: onSubmitHandler,\n      onChangeHandler: onChangeHandler,\n      loading: loading,\n      stateFormData: stateFormData,\n      stateFormError: stateFormError,\n      stateFormMessage: stateFormMessage\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 11\n    }\n  }))));\n}\n/* getServerSideProps */\n\n\n_s(Register, \"d2QlmHZvILVFvKpoDcBxfnxqU30=\", false, function () {\n  return [useRouter];\n});\n\n_c = Register;\nexport var __N_SSP = true;\nexport default Register;\n\nvar _c;\n\n$RefreshReg$(_c, \"Register\");","map":{"version":3,"sources":["C:/Users/Mr.X/Desktop/nextjs-sequelize/pages/user/register.js"],"names":["React","useState","useEffect","Link","useRouter","Layout","FormRegister","emailRegEx","FORM_DATA_REGISTER","username","value","label","min","max","required","validator","regEx","error","email","password","Register","props","router","origin","baseApiUrl","loading","setLoading","stateFormData","setStateFormData","stateFormError","setStateFormError","stateFormValid","setStateFormValid","stateFormMessage","setStateFormMessage","onChangeHandler","e","currentTarget","name","validationHandler","onSubmitHandler","preventDefault","data","isValid","fetch","method","then","response","json","res","x","filter","user","length","console","log","headers","Accept","body","JSON","stringify","loginApi","result","status","message","window","location","href","isUser","states","input","target","errors","hint","isInvalid","test","Object","entries","forEach","item","field","asPath","pathname"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/router';\r\n\r\n/* utils */\r\nimport { absoluteUrl } from '../../middleware/utils';\r\n\r\n/* components */\r\nimport Layout from '../../components/layout/Layout';\r\nimport FormRegister from '../../components/form/FormRegister';\r\n\r\nconst emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n/* register schemas */\r\nconst FORM_DATA_REGISTER = {\r\n  username: {\r\n    value: '',\r\n    label: 'Username',\r\n    min: 5,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\r\n      error: 'Username fill correctly',\r\n    },\r\n  },\r\n  email: {\r\n    value: '',\r\n    label: 'Email',\r\n    min: 10,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: emailRegEx,\r\n      error: 'Email fill correctly',\r\n    },\r\n  },\r\n  password: {\r\n    value: '',\r\n    label: 'Password',\r\n    min: 5,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\r\n      error: 'Password fill correctly',\r\n    },\r\n  },\r\n};\r\n\r\nfunction Register(props) {\r\n  const router = useRouter();\r\n  const { origin, baseApiUrl } = props;\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [stateFormData, setStateFormData] = useState(FORM_DATA_REGISTER);\r\n  const [stateFormError, setStateFormError] = useState([]);\r\n  const [stateFormValid, setStateFormValid] = useState(false);\r\n  const [stateFormMessage, setStateFormMessage] = useState({});\r\n\r\n  function onChangeHandler(e) {\r\n    const { name, value } = e.currentTarget;\r\n\r\n    setStateFormData({\r\n      ...stateFormData,\r\n      [name]: {\r\n        ...stateFormData[name],\r\n        value,\r\n      },\r\n    });\r\n\r\n    /* validation handler */\r\n    validationHandler(stateFormData, e);\r\n  }\r\n\r\n  async function onSubmitHandler(e) {\r\n    e.preventDefault();\r\n\r\n    let data = { ...stateFormData };\r\n\r\n    const isValid = validationHandler(stateFormData);\r\n\r\n    if (isValid) {\r\n      data = { ...data, username: data.username.value };\r\n      data = { ...data, email: data.email.value };\r\n      data = { ...data, password: data.password.value };\r\n\r\n      const isValid = validationHandler(stateFormData);\r\n\r\n      if (isValid) {\r\n        setLoading(!loading);\r\n\r\n        const isUser = await fetch(`${baseApiUrl}/user`, {\r\n          method: 'GET',\r\n        }).then(function (response) {\r\n          return response.json();\r\n        }).then(function (res) {\r\n          var x = res.data.filter(user => user.email === data.email)\r\n          if (x.length >= 1) {\r\n            isValid = false;\r\n            console.log('already exists')\r\n          } else {\r\n            const x = async function () {\r\n              const loginApi = await fetch(`${baseApiUrl}/user`, {\r\n                method: 'POST',\r\n                headers: {\r\n                  Accept: 'application/json',\r\n                  'Content-Type': 'application/json',\r\n                },\r\n                body: JSON.stringify(data),\r\n              }).catch(error => {\r\n                console.error('Error:', error);\r\n              })\r\n              let result = await loginApi.json();\r\n              if (result.status === 'success' && result.message === 'done') {\r\n                window.location.href = '/';\r\n              } else {\r\n                setStateFormMessage(result);\r\n              }\r\n            }\r\n            x()\r\n          }\r\n        }).then(()=> {\r\n          isValid = true\r\n          console.log(isValid)\r\n        })\r\n        setLoading(false);\r\n      }\r\n    }\r\n  }\r\n\r\n  function validationHandler(states, e) {\r\n    const input = (e && e.target.name) || '';\r\n    const errors = [];\r\n    let isValid = true;\r\n\r\n    if (input) {\r\n      if (states[input].required) {\r\n        if (!states[input].value) {\r\n          errors[input] = {\r\n            hint: `${states[e.target.name].label} required`,\r\n            isInvalid: true,\r\n          };\r\n          isValid = false;\r\n        }\r\n      }\r\n      if (\r\n        states[input].value &&\r\n        states[input].min > states[input].value.length\r\n      ) {\r\n        errors[input] = {\r\n          hint: `Min ${states[input].label} length ${states[input].min}`,\r\n          isInvalid: true,\r\n        };\r\n        isValid = false;\r\n      }\r\n      if (\r\n        states[input].value &&\r\n        states[input].max < states[input].value.length\r\n      ) {\r\n        errors[input] = {\r\n          hint: `Min ${states[input].label} length ${states[input].max}`,\r\n          isInvalid: true,\r\n        };\r\n        isValid = false;\r\n      }\r\n      if (\r\n        states[input].validator !== null &&\r\n        typeof states[input].validator === 'object'\r\n      ) {\r\n        if (\r\n          states[input].value &&\r\n          !states[input].validator.regEx.test(states[input].value)\r\n        ) {\r\n          errors[input] = {\r\n            hint: states[input].validator.error,\r\n            isInvalid: true,\r\n          };\r\n          isValid = false;\r\n        }\r\n      }\r\n    } else {\r\n      Object.entries(states).forEach(item => {\r\n        item.forEach(field => {\r\n          errors[item[0]] = '';\r\n          if (field.required) {\r\n            if (!field.value) {\r\n              errors[item[0]] = {\r\n                hint: `${field.label} required`,\r\n                isInvalid: true,\r\n              };\r\n              isValid = false;\r\n            }\r\n          }\r\n          if (field.value && field.min >= field.value.length) {\r\n            errors[item[0]] = {\r\n              hint: `Min ${field.label} length ${field.min}`,\r\n              isInvalid: true,\r\n            };\r\n            isValid = false;\r\n          }\r\n          if (field.value && field.max <= field.value.length) {\r\n            errors[item[0]] = {\r\n              hint: `Min ${field.label} length ${field.max}`,\r\n              isInvalid: true,\r\n            };\r\n            isValid = false;\r\n          }\r\n          if (field.validator !== null && typeof field.validator === 'object') {\r\n            if (field.value && !field.validator.regEx.test(field.value)) {\r\n              errors[item[0]] = {\r\n                hint: field.validator.error,\r\n                isInvalid: true,\r\n              };\r\n              isValid = false;\r\n            }\r\n          }\r\n        });\r\n      });\r\n    }\r\n    if (isValid) {\r\n      setStateFormValid(isValid);\r\n    }\r\n    setStateFormError({\r\n      ...errors,\r\n    });\r\n    return isValid;\r\n  }\r\n\r\n  return (\r\n    <Layout\r\n      title=\"Next.js with Sequelize | Register page\"\r\n      url={`${origin}${router.asPath}`}\r\n      origin={origin}\r\n    >\r\n      <div className=\"container\">\r\n        <main className=\"content-detail\">\r\n          <Link\r\n            href={{\r\n              pathname: '/user',\r\n            }}\r\n          >\r\n            <a>&larr; Back</a>\r\n          </Link>\r\n          <FormRegister\r\n            props={{\r\n              onSubmitHandler,\r\n              onChangeHandler,\r\n              loading,\r\n              stateFormData,\r\n              stateFormError,\r\n              stateFormMessage,\r\n            }}\r\n          />\r\n        </main>\r\n      </div>\r\n    </Layout>\r\n  );\r\n}\r\n\r\n/* getServerSideProps */\r\nexport async function getServerSideProps(context) {\r\n  const { req } = context;\r\n  const { origin } = absoluteUrl(req);\r\n\r\n  const referer = req.headers.referer || '';\r\n  const baseApiUrl = `${origin}/api`;\r\n\r\n  return {\r\n    props: {\r\n      origin,\r\n      baseApiUrl,\r\n      referer,\r\n    },\r\n  };\r\n}\r\n\r\nexport default Register;\r\n"]},"metadata":{},"sourceType":"module"}