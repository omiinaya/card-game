{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Mr.X\\\\Desktop\\\\nextjs-sequelize\\\\pages\\\\register.js\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport models from '../db/models/index';\nimport { useRouter } from 'next/router';\n/* utils */\n\nimport { absoluteUrl } from '../middleware/utils';\n/* components */\n\nimport Layout from '../components/layout/Layout';\nimport FormRegister from '../components/form/FormRegister';\nconst emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n/* register schemas */\n\nconst FORM_DATA_REGISTER = {\n  username: {\n    value: '',\n    label: 'Username',\n    min: 5,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Username fill correctly'\n    }\n  },\n  email: {\n    value: '',\n    label: 'Email',\n    min: 10,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: emailRegEx,\n      error: 'Email fill correctly'\n    }\n  },\n  password: {\n    value: '',\n    label: 'Password',\n    min: 5,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Password fill correctly'\n    }\n  }\n};\n\nfunction Register(props) {\n  const router = useRouter();\n  const {\n    origin,\n    baseApiUrl\n  } = props;\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: stateFormData,\n    1: setStateFormData\n  } = useState(FORM_DATA_REGISTER);\n  const {\n    0: stateFormError,\n    1: setStateFormError\n  } = useState([]);\n  const {\n    0: stateFormValid,\n    1: setStateFormValid\n  } = useState(false);\n  const {\n    0: stateFormMessage,\n    1: setStateFormMessage\n  } = useState({});\n\n  function onChangeHandler(e) {\n    const {\n      name,\n      value\n    } = e.currentTarget;\n    setStateFormData(_objectSpread(_objectSpread({}, stateFormData), {}, {\n      [name]: _objectSpread(_objectSpread({}, stateFormData[name]), {}, {\n        value\n      })\n    }));\n    /* validation handler */\n\n    validationHandler(stateFormData, e);\n  }\n\n  async function onSubmitHandler(e) {\n    e.preventDefault();\n\n    let data = _objectSpread({}, stateFormData);\n\n    const isValid = validationHandler(stateFormData);\n\n    if (isValid) {\n      data = _objectSpread(_objectSpread({}, data), {}, {\n        username: data.username.value\n      });\n      data = _objectSpread(_objectSpread({}, data), {}, {\n        email: data.email.value\n      });\n      data = _objectSpread(_objectSpread({}, data), {}, {\n        password: data.password.value\n      });\n      const isValid = validationHandler(stateFormData);\n\n      if (isValid) {\n        setLoading(!loading);\n        let user = await models.users.findOne({\n          where: {\n            email: email\n          },\n          attributes: ['id', 'email', 'password'],\n          limit: 1\n        });\n        console.log(user);\n        /*\r\n        const loginApi = await fetch(`${baseApiUrl}/user`, {\r\n          method: 'POST',\r\n          headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(data),\r\n        }).catch(error => {\r\n          console.error('Error:', error);\r\n        })\r\n        let result = await loginApi.json();\r\n        if (result.status === 'success' && result.message === 'done') {\r\n          window.location.href = '/';\r\n        }\r\n        }\r\n        */\n\n        setLoading(false);\n      }\n    }\n  }\n\n  function validationHandler(states, e) {\n    const input = e && e.target.name || '';\n    const errors = [];\n    let isValid = true;\n\n    if (input) {\n      if (states[input].required) {\n        if (!states[input].value) {\n          errors[input] = {\n            hint: `${states[e.target.name].label} required`,\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n\n      if (states[input].value && states[input].min > states[input].value.length) {\n        errors[input] = {\n          hint: `Min ${states[input].label} length ${states[input].min}`,\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].value && states[input].max < states[input].value.length) {\n        errors[input] = {\n          hint: `Min ${states[input].label} length ${states[input].max}`,\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].validator !== null && typeof states[input].validator === 'object') {\n        if (states[input].value && !states[input].validator.regEx.test(states[input].value)) {\n          errors[input] = {\n            hint: states[input].validator.error,\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n    } else {\n      Object.entries(states).forEach(item => {\n        item.forEach(field => {\n          errors[item[0]] = '';\n\n          if (field.required) {\n            if (!field.value) {\n              errors[item[0]] = {\n                hint: `${field.label} required`,\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n\n          if (field.value && field.min >= field.value.length) {\n            errors[item[0]] = {\n              hint: `Min ${field.label} length ${field.min}`,\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.value && field.max <= field.value.length) {\n            errors[item[0]] = {\n              hint: `Min ${field.label} length ${field.max}`,\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.validator !== null && typeof field.validator === 'object') {\n            if (field.value && !field.validator.regEx.test(field.value)) {\n              errors[item[0]] = {\n                hint: field.validator.error,\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n        });\n      });\n    }\n\n    if (isValid) {\n      setStateFormValid(isValid);\n    }\n\n    setStateFormError(_objectSpread({}, errors));\n    return isValid;\n  }\n\n  return __jsx(Layout, {\n    title: \"Next.js with Sequelize | Register page\",\n    url: `${origin}${router.asPath}`,\n    origin: origin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 3\n    }\n  }, __jsx(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 5\n    }\n  }, __jsx(\"main\", {\n    className: \"content-detail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 7\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: '/'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 229,\n      columnNumber: 9\n    }\n  }, __jsx(\"a\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 11\n    }\n  }, \"\\u2190 Back\")), __jsx(FormRegister, {\n    props: {\n      onSubmitHandler,\n      onChangeHandler,\n      loading,\n      stateFormData,\n      stateFormError,\n      stateFormMessage\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }\n  }))));\n}\n/* getServerSideProps */\n\n\nexport async function getServerSideProps(context) {\n  const {\n    req\n  } = context;\n  const {\n    origin\n  } = absoluteUrl(req);\n  const referer = req.headers.referer || '';\n  const baseApiUrl = `${origin}/api`;\n  return {\n    props: {\n      origin,\n      baseApiUrl,\n      referer\n    }\n  };\n}\nexport default Register;","map":{"version":3,"sources":["C:/Users/Mr.X/Desktop/nextjs-sequelize/pages/register.js"],"names":["React","useState","useEffect","Link","models","useRouter","absoluteUrl","Layout","FormRegister","emailRegEx","FORM_DATA_REGISTER","username","value","label","min","max","required","validator","regEx","error","email","password","Register","props","router","origin","baseApiUrl","loading","setLoading","stateFormData","setStateFormData","stateFormError","setStateFormError","stateFormValid","setStateFormValid","stateFormMessage","setStateFormMessage","onChangeHandler","e","name","currentTarget","validationHandler","onSubmitHandler","preventDefault","data","isValid","user","users","findOne","where","attributes","limit","console","log","states","input","target","errors","hint","isInvalid","length","test","Object","entries","forEach","item","field","asPath","pathname","getServerSideProps","context","req","referer","headers"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport models from '../db/models/index';\r\nimport { useRouter } from 'next/router';\r\n\r\n/* utils */\r\nimport { absoluteUrl } from '../middleware/utils';\r\n\r\n/* components */\r\nimport Layout from '../components/layout/Layout';\r\nimport FormRegister from '../components/form/FormRegister';\r\n\r\nconst emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n\r\n/* register schemas */\r\nconst FORM_DATA_REGISTER = {\r\n  username: {\r\n    value: '',\r\n    label: 'Username',\r\n    min: 5,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\r\n      error: 'Username fill correctly',\r\n    },\r\n  },\r\n  email: {\r\n    value: '',\r\n    label: 'Email',\r\n    min: 10,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: emailRegEx,\r\n      error: 'Email fill correctly',\r\n    },\r\n  },\r\n  password: {\r\n    value: '',\r\n    label: 'Password',\r\n    min: 5,\r\n    max: 36,\r\n    required: true,\r\n    validator: {\r\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\r\n      error: 'Password fill correctly',\r\n    },\r\n  },\r\n};\r\n\r\nfunction Register(props) {\r\n  const router = useRouter();\r\n  const { origin, baseApiUrl } = props;\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const [stateFormData, setStateFormData] = useState(FORM_DATA_REGISTER);\r\n  const [stateFormError, setStateFormError] = useState([]);\r\n  const [stateFormValid, setStateFormValid] = useState(false);\r\n  const [stateFormMessage, setStateFormMessage] = useState({});\r\n\r\n  function onChangeHandler(e) {\r\n    const { name, value } = e.currentTarget;\r\n\r\n    setStateFormData({\r\n      ...stateFormData,\r\n      [name]: {\r\n        ...stateFormData[name],\r\n        value,\r\n      },\r\n    });\r\n\r\n    /* validation handler */\r\n    validationHandler(stateFormData, e);\r\n  }\r\n\r\n  async function onSubmitHandler(e) {\r\n    e.preventDefault();\r\n\r\n    let data = { ...stateFormData };\r\n\r\n    const isValid = validationHandler(stateFormData);\r\n\r\n    if (isValid) {\r\n      data = { ...data, username: data.username.value };\r\n      data = { ...data, email: data.email.value };\r\n      data = { ...data, password: data.password.value };\r\n\r\n      const isValid = validationHandler(stateFormData);\r\n\r\n      if (isValid) {\r\n        setLoading(!loading);\r\n\r\n        let user = await models.users.findOne({\r\n          where: { email: email },\r\n          attributes: ['id', 'email', 'password'],\r\n          limit: 1,\r\n        });\r\n\r\n        console.log(user)\r\n        /*\r\n        const loginApi = await fetch(`${baseApiUrl}/user`, {\r\n          method: 'POST',\r\n          headers: {\r\n            Accept: 'application/json',\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(data),\r\n        }).catch(error => {\r\n          console.error('Error:', error);\r\n        })\r\n        let result = await loginApi.json();\r\n        if (result.status === 'success' && result.message === 'done') {\r\n          window.location.href = '/';\r\n        }\r\n      }\r\n      */\r\n      setLoading(false);\r\n    }\r\n  }\r\n}\r\n\r\nfunction validationHandler(states, e) {\r\n  const input = (e && e.target.name) || '';\r\n  const errors = [];\r\n  let isValid = true;\r\n\r\n  if (input) {\r\n    if (states[input].required) {\r\n      if (!states[input].value) {\r\n        errors[input] = {\r\n          hint: `${states[e.target.name].label} required`,\r\n          isInvalid: true,\r\n        };\r\n        isValid = false;\r\n      }\r\n    }\r\n    if (\r\n      states[input].value &&\r\n      states[input].min > states[input].value.length\r\n    ) {\r\n      errors[input] = {\r\n        hint: `Min ${states[input].label} length ${states[input].min}`,\r\n        isInvalid: true,\r\n      };\r\n      isValid = false;\r\n    }\r\n    if (\r\n      states[input].value &&\r\n      states[input].max < states[input].value.length\r\n    ) {\r\n      errors[input] = {\r\n        hint: `Min ${states[input].label} length ${states[input].max}`,\r\n        isInvalid: true,\r\n      };\r\n      isValid = false;\r\n    }\r\n    if (\r\n      states[input].validator !== null &&\r\n      typeof states[input].validator === 'object'\r\n    ) {\r\n      if (\r\n        states[input].value &&\r\n        !states[input].validator.regEx.test(states[input].value)\r\n      ) {\r\n        errors[input] = {\r\n          hint: states[input].validator.error,\r\n          isInvalid: true,\r\n        };\r\n        isValid = false;\r\n      }\r\n    }\r\n  } else {\r\n    Object.entries(states).forEach(item => {\r\n      item.forEach(field => {\r\n        errors[item[0]] = '';\r\n        if (field.required) {\r\n          if (!field.value) {\r\n            errors[item[0]] = {\r\n              hint: `${field.label} required`,\r\n              isInvalid: true,\r\n            };\r\n            isValid = false;\r\n          }\r\n        }\r\n        if (field.value && field.min >= field.value.length) {\r\n          errors[item[0]] = {\r\n            hint: `Min ${field.label} length ${field.min}`,\r\n            isInvalid: true,\r\n          };\r\n          isValid = false;\r\n        }\r\n        if (field.value && field.max <= field.value.length) {\r\n          errors[item[0]] = {\r\n            hint: `Min ${field.label} length ${field.max}`,\r\n            isInvalid: true,\r\n          };\r\n          isValid = false;\r\n        }\r\n        if (field.validator !== null && typeof field.validator === 'object') {\r\n          if (field.value && !field.validator.regEx.test(field.value)) {\r\n            errors[item[0]] = {\r\n              hint: field.validator.error,\r\n              isInvalid: true,\r\n            };\r\n            isValid = false;\r\n          }\r\n        }\r\n      });\r\n    });\r\n  }\r\n  if (isValid) {\r\n    setStateFormValid(isValid);\r\n  }\r\n  setStateFormError({\r\n    ...errors,\r\n  });\r\n  return isValid;\r\n}\r\n\r\nreturn (\r\n  <Layout\r\n    title=\"Next.js with Sequelize | Register page\"\r\n    url={`${origin}${router.asPath}`}\r\n    origin={origin}\r\n  >\r\n    <div className=\"container\">\r\n      <main className=\"content-detail\">\r\n        <Link\r\n          href={{\r\n            pathname: '/',\r\n          }}\r\n        >\r\n          <a>&larr; Back</a>\r\n        </Link>\r\n        <FormRegister\r\n          props={{\r\n            onSubmitHandler,\r\n            onChangeHandler,\r\n            loading,\r\n            stateFormData,\r\n            stateFormError,\r\n            stateFormMessage,\r\n          }}\r\n        />\r\n      </main>\r\n    </div>\r\n  </Layout>\r\n);\r\n}\r\n\r\n/* getServerSideProps */\r\nexport async function getServerSideProps(context) {\r\n  const { req } = context;\r\n  const { origin } = absoluteUrl(req);\r\n\r\n  const referer = req.headers.referer || '';\r\n  const baseApiUrl = `${origin}/api`;\r\n\r\n  return {\r\n    props: {\r\n      origin,\r\n      baseApiUrl,\r\n      referer,\r\n    },\r\n  };\r\n}\r\n\r\nexport default Register;\r\n"]},"metadata":{},"sourceType":"module"}