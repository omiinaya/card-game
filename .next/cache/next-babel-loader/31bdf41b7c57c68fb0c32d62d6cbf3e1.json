{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\Nfernal\\\\Desktop\\\\nextjs-sequelize\\\\pages\\\\login.js\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport Router, { useRouter } from 'next/router';\nimport Cookies from 'js-cookie';\n/* utils */\n\nimport FormLogin from '../components/form/FormLogin';\nvar emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n/* login schemas */\n\nvar FORM_DATA_LOGIN = {\n  username: {\n    value: '',\n    label: 'Username',\n    min: 3,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Please insert valid username'\n    }\n  },\n  password: {\n    value: '',\n    label: 'Password',\n    min: 3,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Please insert valid password'\n    }\n  }\n};\n\nfunction Login(props) {\n  _s();\n\n  var router = useRouter();\n  var origin = props.origin,\n      referer = props.referer,\n      baseApiUrl = props.baseApiUrl;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(FORM_DATA_LOGIN),\n      stateFormData = _useState2[0],\n      setStateFormData = _useState2[1];\n\n  var _useState3 = useState([]),\n      stateFormError = _useState3[0],\n      setStateFormError = _useState3[1];\n\n  var _useState4 = useState(false),\n      stateFormValid = _useState4[0],\n      setStateFormValid = _useState4[1];\n\n  var _useState5 = useState({}),\n      stateFormMessage = _useState5[0],\n      setStateFormMessage = _useState5[1];\n\n  function onChangeHandler(e) {\n    var _e$currentTarget = e.currentTarget,\n        name = _e$currentTarget.name,\n        value = _e$currentTarget.value;\n    setStateFormData(_objectSpread(_objectSpread({}, stateFormData), {}, _defineProperty({}, name, _objectSpread(_objectSpread({}, stateFormData[name]), {}, {\n      value: value\n    }))));\n    /* validation handler */\n\n    validationHandler(stateFormData, e);\n  }\n\n  function onSubmitHandler(_x) {\n    return _onSubmitHandler.apply(this, arguments);\n  }\n\n  function _onSubmitHandler() {\n    _onSubmitHandler = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var data, isValid, loginApi, result;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              data = _objectSpread({}, stateFormData);\n              /* email */\n\n              data = _objectSpread(_objectSpread({}, data), {}, {\n                username: data.username.value || ''\n              });\n              /* password */\n\n              data = _objectSpread(_objectSpread({}, data), {}, {\n                password: data.password.value || ''\n              });\n              /* validation handler */\n\n              isValid = validationHandler(stateFormData);\n\n              if (!isValid) {\n                _context.next = 16;\n                break;\n              }\n\n              // Call an external API endpoint to get posts.\n              // You can use any data fetching library\n              setLoading(!loading);\n              console.log(data);\n              _context.next = 10;\n              return fetch(\"\".concat(baseApiUrl, \"/auth\"), {\n                method: 'POST',\n                headers: {\n                  Accept: 'application/json',\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(data)\n              })[\"catch\"](function (error) {\n                console.error('Error:', error);\n              });\n\n            case 10:\n              loginApi = _context.sent;\n              _context.next = 13;\n              return loginApi.json();\n\n            case 13:\n              result = _context.sent;\n\n              if (result.success && result.token) {\n                Cookies.set('token', result.token); // window.location.href = referer ? referer : \"/\";\n                // const pathUrl = referer ? referer.lastIndexOf(\"/\") : \"/\";\n\n                Router.push('/');\n              } else {\n                setStateFormMessage(result);\n              }\n\n              setLoading(false);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _onSubmitHandler.apply(this, arguments);\n  }\n\n  function validationHandler(states, e) {\n    var input = e && e.target.name || '';\n    var errors = [];\n    var isValid = true;\n\n    if (input) {\n      if (states[input].required) {\n        if (!states[input].value) {\n          errors[input] = {\n            hint: \"\".concat(states[e.target.name].label, \" required\"),\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n\n      if (states[input].value && states[input].min > states[input].value.length) {\n        errors[input] = {\n          hint: \"Field \".concat(states[input].label, \" min \").concat(states[input].min),\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].value && states[input].max < states[input].value.length) {\n        errors[input] = {\n          hint: \"Field \".concat(states[input].label, \" max \").concat(states[input].max),\n          isInvalid: true\n        };\n        isValid = false;\n      }\n\n      if (states[input].validator !== null && typeof states[input].validator === 'object') {\n        if (states[input].value && !states[input].validator.regEx.test(states[input].value)) {\n          errors[input] = {\n            hint: states[input].validator.error,\n            isInvalid: true\n          };\n          isValid = false;\n        }\n      }\n    } else {\n      Object.entries(states).forEach(function (item) {\n        item.forEach(function (field) {\n          errors[item[0]] = '';\n\n          if (field.required) {\n            if (!field.value) {\n              errors[item[0]] = {\n                hint: \"\".concat(field.label, \" required\"),\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n\n          if (field.value && field.min >= field.value.length) {\n            errors[item[0]] = {\n              hint: \"Field \".concat(field.label, \" min \").concat(field.min),\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.value && field.max <= field.value.length) {\n            errors[item[0]] = {\n              hint: \"Field \".concat(field.label, \" max \").concat(field.max),\n              isInvalid: true\n            };\n            isValid = false;\n          }\n\n          if (field.validator !== null && typeof field.validator === 'object') {\n            if (field.value && !field.validator.regEx.test(field.value)) {\n              errors[item[0]] = {\n                hint: field.validator.error,\n                isInvalid: true\n              };\n              isValid = false;\n            }\n          }\n        });\n      });\n    }\n\n    if (isValid) {\n      setStateFormValid(isValid);\n    }\n\n    setStateFormError(_objectSpread({}, errors));\n    return isValid;\n  }\n\n  return __jsx(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 5\n    }\n  }, __jsx(\"main\", {\n    className: \"content-detail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 7\n    }\n  }, __jsx(Link, {\n    href: {\n      pathname: '/'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 9\n    }\n  }, __jsx(\"a\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 11\n    }\n  }, \"\\u2190 Back\")), __jsx(FormLogin, {\n    props: {\n      onSubmitHandler: onSubmitHandler,\n      onChangeHandler: onChangeHandler,\n      loading: loading,\n      stateFormData: stateFormData,\n      stateFormError: stateFormError,\n      stateFormMessage: stateFormMessage\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 9\n    }\n  })));\n}\n/* getServerSideProps */\n\n\n_s(Login, \"H74yycDbrUKBie4ozDraexj/joM=\", false, function () {\n  return [useRouter];\n});\n\n_c = Login;\nexport var __N_SSP = true;\nexport default Login;\n\nvar _c;\n\n$RefreshReg$(_c, \"Login\");","map":{"version":3,"sources":["C:/Users/Nfernal/Desktop/nextjs-sequelize/pages/login.js"],"names":["React","useState","useEffect","Link","Router","useRouter","Cookies","FormLogin","emailRegEx","FORM_DATA_LOGIN","username","value","label","min","max","required","validator","regEx","error","password","Login","props","router","origin","referer","baseApiUrl","loading","setLoading","stateFormData","setStateFormData","stateFormError","setStateFormError","stateFormValid","setStateFormValid","stateFormMessage","setStateFormMessage","onChangeHandler","e","currentTarget","name","validationHandler","onSubmitHandler","preventDefault","data","isValid","console","log","fetch","method","headers","Accept","body","JSON","stringify","loginApi","json","result","success","token","set","push","states","input","target","errors","hint","isInvalid","length","test","Object","entries","forEach","item","field","pathname"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,IAAP,MAAiB,WAAjB;AACA,OAAOC,MAAP,IAAiBC,SAAjB,QAAkC,aAAlC;AACA,OAAOC,OAAP,MAAoB,WAApB;AAEA;;AAGA,OAAOC,SAAP,MAAsB,8BAAtB;AAEA,IAAMC,UAAU,GAAG,2JAAnB;AAEA;;AACA,IAAMC,eAAe,GAAG;AACtBC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,KAAK,EAAE,EADC;AAERC,IAAAA,KAAK,EAAE,UAFC;AAGRC,IAAAA,GAAG,EAAE,CAHG;AAIRC,IAAAA,GAAG,EAAE,EAJG;AAKRC,IAAAA,QAAQ,EAAE,IALF;AAMRC,IAAAA,SAAS,EAAE;AACTC,MAAAA,KAAK,EAAE,sBADE;AAETC,MAAAA,KAAK,EAAE;AAFE;AANH,GADY;AAYtBC,EAAAA,QAAQ,EAAE;AACRR,IAAAA,KAAK,EAAE,EADC;AAERC,IAAAA,KAAK,EAAE,UAFC;AAGRC,IAAAA,GAAG,EAAE,CAHG;AAIRC,IAAAA,GAAG,EAAE,EAJG;AAKRC,IAAAA,QAAQ,EAAE,IALF;AAMRC,IAAAA,SAAS,EAAE;AACTC,MAAAA,KAAK,EAAE,sBADE;AAETC,MAAAA,KAAK,EAAE;AAFE;AANH;AAZY,CAAxB;;AAyBA,SAASE,KAAT,CAAeC,KAAf,EAAsB;AAAA;;AACpB,MAAMC,MAAM,GAAGjB,SAAS,EAAxB;AADoB,MAGZkB,MAHY,GAGoBF,KAHpB,CAGZE,MAHY;AAAA,MAGJC,OAHI,GAGoBH,KAHpB,CAGJG,OAHI;AAAA,MAGKC,UAHL,GAGoBJ,KAHpB,CAGKI,UAHL;;AAAA,kBAIUxB,QAAQ,CAAC,KAAD,CAJlB;AAAA,MAIbyB,OAJa;AAAA,MAIJC,UAJI;;AAAA,mBAMsB1B,QAAQ,CAACQ,eAAD,CAN9B;AAAA,MAMbmB,aANa;AAAA,MAMEC,gBANF;;AAAA,mBAOwB5B,QAAQ,CAAC,EAAD,CAPhC;AAAA,MAOb6B,cAPa;AAAA,MAOGC,iBAPH;;AAAA,mBAQwB9B,QAAQ,CAAC,KAAD,CARhC;AAAA,MAQb+B,cARa;AAAA,MAQGC,iBARH;;AAAA,mBAS4BhC,QAAQ,CAAC,EAAD,CATpC;AAAA,MASbiC,gBATa;AAAA,MASKC,mBATL;;AAWpB,WAASC,eAAT,CAAyBC,CAAzB,EAA4B;AAAA,2BACFA,CAAC,CAACC,aADA;AAAA,QAClBC,IADkB,oBAClBA,IADkB;AAAA,QACZ5B,KADY,oBACZA,KADY;AAG1BkB,IAAAA,gBAAgB,iCACXD,aADW,2BAEbW,IAFa,kCAGTX,aAAa,CAACW,IAAD,CAHJ;AAIZ5B,MAAAA,KAAK,EAALA;AAJY,SAAhB;AAQA;;AACA6B,IAAAA,iBAAiB,CAACZ,aAAD,EAAgBS,CAAhB,CAAjB;AACD;;AAxBmB,WA0BLI,eA1BK;AAAA;AAAA;;AAAA;AAAA,gFA0BpB,iBAA+BJ,CAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AACEA,cAAAA,CAAC,CAACK,cAAF;AAEIC,cAAAA,IAHN,qBAGkBf,aAHlB;AAKE;;AACAe,cAAAA,IAAI,mCAAQA,IAAR;AAAcjC,gBAAAA,QAAQ,EAAEiC,IAAI,CAACjC,QAAL,CAAcC,KAAd,IAAuB;AAA/C,gBAAJ;AACA;;AACAgC,cAAAA,IAAI,mCAAQA,IAAR;AAAcxB,gBAAAA,QAAQ,EAAEwB,IAAI,CAACxB,QAAL,CAAcR,KAAd,IAAuB;AAA/C,gBAAJ;AAEA;;AACMiC,cAAAA,OAXR,GAWkBJ,iBAAiB,CAACZ,aAAD,CAXnC;;AAAA,mBAaMgB,OAbN;AAAA;AAAA;AAAA;;AAcI;AACA;AACAjB,cAAAA,UAAU,CAAC,CAACD,OAAF,CAAV;AACAmB,cAAAA,OAAO,CAACC,GAAR,CAAYH,IAAZ;AAjBJ;AAAA,qBAkB2BI,KAAK,WAAItB,UAAJ,YAAuB;AACjDuB,gBAAAA,MAAM,EAAE,MADyC;AAEjDC,gBAAAA,OAAO,EAAE;AACPC,kBAAAA,MAAM,EAAE,kBADD;AAEP,kCAAgB;AAFT,iBAFwC;AAMjDC,gBAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeV,IAAf;AAN2C,eAAvB,CAAL,UAOd,UAAAzB,KAAK,EAAI;AAChB2B,gBAAAA,OAAO,CAAC3B,KAAR,CAAc,QAAd,EAAwBA,KAAxB;AACD,eATsB,CAlB3B;;AAAA;AAkBUoC,cAAAA,QAlBV;AAAA;AAAA,qBA4BuBA,QAAQ,CAACC,IAAT,EA5BvB;;AAAA;AA4BQC,cAAAA,MA5BR;;AA6BI,kBAAIA,MAAM,CAACC,OAAP,IAAkBD,MAAM,CAACE,KAA7B,EAAoC;AAClCpD,gBAAAA,OAAO,CAACqD,GAAR,CAAY,OAAZ,EAAqBH,MAAM,CAACE,KAA5B,EADkC,CAElC;AACA;;AACAtD,gBAAAA,MAAM,CAACwD,IAAP,CAAY,GAAZ;AACD,eALD,MAKO;AACLzB,gBAAAA,mBAAmB,CAACqB,MAAD,CAAnB;AACD;;AACD7B,cAAAA,UAAU,CAAC,KAAD,CAAV;;AArCJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA1BoB;AAAA;AAAA;;AAmEpB,WAASa,iBAAT,CAA2BqB,MAA3B,EAAmCxB,CAAnC,EAAsC;AACpC,QAAMyB,KAAK,GAAIzB,CAAC,IAAIA,CAAC,CAAC0B,MAAF,CAASxB,IAAf,IAAwB,EAAtC;AACA,QAAMyB,MAAM,GAAG,EAAf;AACA,QAAIpB,OAAO,GAAG,IAAd;;AAEA,QAAIkB,KAAJ,EAAW;AACT,UAAID,MAAM,CAACC,KAAD,CAAN,CAAc/C,QAAlB,EAA4B;AAC1B,YAAI,CAAC8C,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAnB,EAA0B;AACxBqD,UAAAA,MAAM,CAACF,KAAD,CAAN,GAAgB;AACdG,YAAAA,IAAI,YAAKJ,MAAM,CAACxB,CAAC,CAAC0B,MAAF,CAASxB,IAAV,CAAN,CAAsB3B,KAA3B,cADU;AAEdsD,YAAAA,SAAS,EAAE;AAFG,WAAhB;AAIAtB,UAAAA,OAAO,GAAG,KAAV;AACD;AACF;;AACD,UACEiB,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAd,IACAkD,MAAM,CAACC,KAAD,CAAN,CAAcjD,GAAd,GAAoBgD,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAd,CAAoBwD,MAF1C,EAGE;AACAH,QAAAA,MAAM,CAACF,KAAD,CAAN,GAAgB;AACdG,UAAAA,IAAI,kBAAWJ,MAAM,CAACC,KAAD,CAAN,CAAclD,KAAzB,kBAAsCiD,MAAM,CAACC,KAAD,CAAN,CAAcjD,GAApD,CADU;AAEdqD,UAAAA,SAAS,EAAE;AAFG,SAAhB;AAIAtB,QAAAA,OAAO,GAAG,KAAV;AACD;;AACD,UACEiB,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAd,IACAkD,MAAM,CAACC,KAAD,CAAN,CAAchD,GAAd,GAAoB+C,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAd,CAAoBwD,MAF1C,EAGE;AACAH,QAAAA,MAAM,CAACF,KAAD,CAAN,GAAgB;AACdG,UAAAA,IAAI,kBAAWJ,MAAM,CAACC,KAAD,CAAN,CAAclD,KAAzB,kBAAsCiD,MAAM,CAACC,KAAD,CAAN,CAAchD,GAApD,CADU;AAEdoD,UAAAA,SAAS,EAAE;AAFG,SAAhB;AAIAtB,QAAAA,OAAO,GAAG,KAAV;AACD;;AACD,UACEiB,MAAM,CAACC,KAAD,CAAN,CAAc9C,SAAd,KAA4B,IAA5B,IACA,OAAO6C,MAAM,CAACC,KAAD,CAAN,CAAc9C,SAArB,KAAmC,QAFrC,EAGE;AACA,YACE6C,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAd,IACA,CAACkD,MAAM,CAACC,KAAD,CAAN,CAAc9C,SAAd,CAAwBC,KAAxB,CAA8BmD,IAA9B,CAAmCP,MAAM,CAACC,KAAD,CAAN,CAAcnD,KAAjD,CAFH,EAGE;AACAqD,UAAAA,MAAM,CAACF,KAAD,CAAN,GAAgB;AACdG,YAAAA,IAAI,EAAEJ,MAAM,CAACC,KAAD,CAAN,CAAc9C,SAAd,CAAwBE,KADhB;AAEdgD,YAAAA,SAAS,EAAE;AAFG,WAAhB;AAIAtB,UAAAA,OAAO,GAAG,KAAV;AACD;AACF;AACF,KA7CD,MA6CO;AACLyB,MAAAA,MAAM,CAACC,OAAP,CAAeT,MAAf,EAAuBU,OAAvB,CAA+B,UAAAC,IAAI,EAAI;AACrCA,QAAAA,IAAI,CAACD,OAAL,CAAa,UAAAE,KAAK,EAAI;AACpBT,UAAAA,MAAM,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB,EAAlB;;AACA,cAAIC,KAAK,CAAC1D,QAAV,EAAoB;AAClB,gBAAI,CAAC0D,KAAK,CAAC9D,KAAX,EAAkB;AAChBqD,cAAAA,MAAM,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB;AAChBP,gBAAAA,IAAI,YAAKQ,KAAK,CAAC7D,KAAX,cADY;AAEhBsD,gBAAAA,SAAS,EAAE;AAFK,eAAlB;AAIAtB,cAAAA,OAAO,GAAG,KAAV;AACD;AACF;;AACD,cAAI6B,KAAK,CAAC9D,KAAN,IAAe8D,KAAK,CAAC5D,GAAN,IAAa4D,KAAK,CAAC9D,KAAN,CAAYwD,MAA5C,EAAoD;AAClDH,YAAAA,MAAM,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB;AAChBP,cAAAA,IAAI,kBAAWQ,KAAK,CAAC7D,KAAjB,kBAA8B6D,KAAK,CAAC5D,GAApC,CADY;AAEhBqD,cAAAA,SAAS,EAAE;AAFK,aAAlB;AAIAtB,YAAAA,OAAO,GAAG,KAAV;AACD;;AACD,cAAI6B,KAAK,CAAC9D,KAAN,IAAe8D,KAAK,CAAC3D,GAAN,IAAa2D,KAAK,CAAC9D,KAAN,CAAYwD,MAA5C,EAAoD;AAClDH,YAAAA,MAAM,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB;AAChBP,cAAAA,IAAI,kBAAWQ,KAAK,CAAC7D,KAAjB,kBAA8B6D,KAAK,CAAC3D,GAApC,CADY;AAEhBoD,cAAAA,SAAS,EAAE;AAFK,aAAlB;AAIAtB,YAAAA,OAAO,GAAG,KAAV;AACD;;AACD,cAAI6B,KAAK,CAACzD,SAAN,KAAoB,IAApB,IAA4B,OAAOyD,KAAK,CAACzD,SAAb,KAA2B,QAA3D,EAAqE;AACnE,gBAAIyD,KAAK,CAAC9D,KAAN,IAAe,CAAC8D,KAAK,CAACzD,SAAN,CAAgBC,KAAhB,CAAsBmD,IAAtB,CAA2BK,KAAK,CAAC9D,KAAjC,CAApB,EAA6D;AAC3DqD,cAAAA,MAAM,CAACQ,IAAI,CAAC,CAAD,CAAL,CAAN,GAAkB;AAChBP,gBAAAA,IAAI,EAAEQ,KAAK,CAACzD,SAAN,CAAgBE,KADN;AAEhBgD,gBAAAA,SAAS,EAAE;AAFK,eAAlB;AAIAtB,cAAAA,OAAO,GAAG,KAAV;AACD;AACF;AACF,SAlCD;AAmCD,OApCD;AAqCD;;AACD,QAAIA,OAAJ,EAAa;AACXX,MAAAA,iBAAiB,CAACW,OAAD,CAAjB;AACD;;AACDb,IAAAA,iBAAiB,mBACZiC,MADY,EAAjB;AAGA,WAAOpB,OAAP;AACD;;AAED,SACE;AAAK,IAAA,SAAS,EAAC,WAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE;AAAM,IAAA,SAAS,EAAC,gBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACE,MAAC,IAAD;AACE,IAAA,IAAI,EAAE;AACJ8B,MAAAA,QAAQ,EAAE;AADN,KADR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAKE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBALF,CADF,EAQE,MAAC,SAAD;AACE,IAAA,KAAK,EAAE;AACLjC,MAAAA,eAAe,EAAfA,eADK;AAELL,MAAAA,eAAe,EAAfA,eAFK;AAGLV,MAAAA,OAAO,EAAPA,OAHK;AAILE,MAAAA,aAAa,EAAbA,aAJK;AAKLE,MAAAA,cAAc,EAAdA,cALK;AAMLI,MAAAA,gBAAgB,EAAhBA;AANK,KADT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARF,CADF,CADF;AAuBD;AAED;;;GA9LSd,K;UACQf,S;;;KADRe,K;;AA+MT,eAAeA,KAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport Link from 'next/link';\nimport Router, { useRouter } from 'next/router';\nimport Cookies from 'js-cookie';\n\n/* utils */\nimport { absoluteUrl } from '../middleware/utils';\n\nimport FormLogin from '../components/form/FormLogin';\n\nconst emailRegEx = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,2|3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n/* login schemas */\nconst FORM_DATA_LOGIN = {\n  username: {\n    value: '',\n    label: 'Username',\n    min: 3,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Please insert valid username',\n    },\n  },\n  password: {\n    value: '',\n    label: 'Password',\n    min: 3,\n    max: 36,\n    required: true,\n    validator: {\n      regEx: /^[a-z\\sA-Z0-9\\W\\w]+$/,\n      error: 'Please insert valid password',\n    },\n  },\n};\n\nfunction Login(props) {\n  const router = useRouter();\n\n  const { origin, referer, baseApiUrl } = props;\n  const [loading, setLoading] = useState(false);\n\n  const [stateFormData, setStateFormData] = useState(FORM_DATA_LOGIN);\n  const [stateFormError, setStateFormError] = useState([]);\n  const [stateFormValid, setStateFormValid] = useState(false);\n  const [stateFormMessage, setStateFormMessage] = useState({});\n\n  function onChangeHandler(e) {\n    const { name, value } = e.currentTarget;\n\n    setStateFormData({\n      ...stateFormData,\n      [name]: {\n        ...stateFormData[name],\n        value,\n      },\n    });\n\n    /* validation handler */\n    validationHandler(stateFormData, e);\n  }\n\n  async function onSubmitHandler(e) {\n    e.preventDefault();\n\n    let data = { ...stateFormData };\n\n    /* email */\n    data = { ...data, username: data.username.value || '' };\n    /* password */\n    data = { ...data, password: data.password.value || '' };\n\n    /* validation handler */\n    const isValid = validationHandler(stateFormData);\n\n    if (isValid) {\n      // Call an external API endpoint to get posts.\n      // You can use any data fetching library\n      setLoading(!loading);\n      console.log(data)\n      const loginApi = await fetch(`${baseApiUrl}/auth`, {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      }).catch(error => {\n        console.error('Error:', error);\n      });\n      let result = await loginApi.json();\n      if (result.success && result.token) {\n        Cookies.set('token', result.token);\n        // window.location.href = referer ? referer : \"/\";\n        // const pathUrl = referer ? referer.lastIndexOf(\"/\") : \"/\";\n        Router.push('/');\n      } else {\n        setStateFormMessage(result);\n      }\n      setLoading(false);\n    }\n  }\n\n  function validationHandler(states, e) {\n    const input = (e && e.target.name) || '';\n    const errors = [];\n    let isValid = true;\n\n    if (input) {\n      if (states[input].required) {\n        if (!states[input].value) {\n          errors[input] = {\n            hint: `${states[e.target.name].label} required`,\n            isInvalid: true,\n          };\n          isValid = false;\n        }\n      }\n      if (\n        states[input].value &&\n        states[input].min > states[input].value.length\n      ) {\n        errors[input] = {\n          hint: `Field ${states[input].label} min ${states[input].min}`,\n          isInvalid: true,\n        };\n        isValid = false;\n      }\n      if (\n        states[input].value &&\n        states[input].max < states[input].value.length\n      ) {\n        errors[input] = {\n          hint: `Field ${states[input].label} max ${states[input].max}`,\n          isInvalid: true,\n        };\n        isValid = false;\n      }\n      if (\n        states[input].validator !== null &&\n        typeof states[input].validator === 'object'\n      ) {\n        if (\n          states[input].value &&\n          !states[input].validator.regEx.test(states[input].value)\n        ) {\n          errors[input] = {\n            hint: states[input].validator.error,\n            isInvalid: true,\n          };\n          isValid = false;\n        }\n      }\n    } else {\n      Object.entries(states).forEach(item => {\n        item.forEach(field => {\n          errors[item[0]] = '';\n          if (field.required) {\n            if (!field.value) {\n              errors[item[0]] = {\n                hint: `${field.label} required`,\n                isInvalid: true,\n              };\n              isValid = false;\n            }\n          }\n          if (field.value && field.min >= field.value.length) {\n            errors[item[0]] = {\n              hint: `Field ${field.label} min ${field.min}`,\n              isInvalid: true,\n            };\n            isValid = false;\n          }\n          if (field.value && field.max <= field.value.length) {\n            errors[item[0]] = {\n              hint: `Field ${field.label} max ${field.max}`,\n              isInvalid: true,\n            };\n            isValid = false;\n          }\n          if (field.validator !== null && typeof field.validator === 'object') {\n            if (field.value && !field.validator.regEx.test(field.value)) {\n              errors[item[0]] = {\n                hint: field.validator.error,\n                isInvalid: true,\n              };\n              isValid = false;\n            }\n          }\n        });\n      });\n    }\n    if (isValid) {\n      setStateFormValid(isValid);\n    }\n    setStateFormError({\n      ...errors,\n    });\n    return isValid;\n  }\n\n  return (\n    <div className=\"container\">\n      <main className=\"content-detail\">\n        <Link\n          href={{\n            pathname: '/',\n          }}\n        >\n          <a>&larr; Back</a>\n        </Link>\n        <FormLogin\n          props={{\n            onSubmitHandler,\n            onChangeHandler,\n            loading,\n            stateFormData,\n            stateFormError,\n            stateFormMessage,\n          }}\n        />\n      </main>\n    </div>\n  );\n}\n\n/* getServerSideProps */\nexport async function getServerSideProps(context) {\n  const { req } = context;\n  const { origin } = absoluteUrl(req);\n\n  const referer = req.headers.referer || '';\n  const baseApiUrl = `${origin}/api`;\n\n  return {\n    props: {\n      origin,\n      referer,\n      baseApiUrl,\n    },\n  };\n}\n\nexport default Login;\n"]},"metadata":{},"sourceType":"module"}